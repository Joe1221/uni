\documentclass{beamer}
\usepackage{fontspec}
\usepackage{polyglossia}
\setmainlanguage{german}
%\setotherlanguage{greek}
\usepackage{xparse}
\usepackage{mymath}

\usetheme{Luebeck}
\setbeamertemplate{theorems}[normal font]

\usepackage{wasysym}

\DeclareDocumentCommand{\dilate}{}{\oplus}
\DeclareDocumentCommand{\erode}{}{\ominus}
\DeclareDocumentCommand{\open}{}{\mathbin{\Circle}}
\DeclareDocumentCommand{\close}{}{\mathbin{\CIRCLE}}
\DeclareDocumentCommand{\openclose}{}{\mathbin{\rotatebox[origin=c]{-90}{\RIGHTcircle}}}
\DeclareDocumentCommand{\closeopen}{}{\mathbin{\rotatebox[origin=c]{90}{\RIGHTcircle}}}
\DeclareDocumentCommand{\wtophat}{}{\sqcap}
\DeclareDocumentCommand{\btophat}{}{\sqcup}
\DeclareDocumentCommand{\hitormiss}{}{\circledcirc}


\DeclareDocumentCommand{\veewedge}{}{\mathbin{\vee\mkern-5mu\wedge}}

% http://tex.stackexchange.com/questions/117117/plus-minus-sign-in-a-circle
\newcommand{\opm}{
    \mathbin{
        \mathchoice
            {\buildcirclepm{\displaystyle     }{0.14ex}{0.95}{0.05ex}{.7}}
            {\buildcirclepm{\textstyle        }{0.14ex}{0.95}{0.05ex}{.7}}
            {\buildcirclepm{\scriptstyle      }{0.13ex}{0.955}{0.04ex}{.55}}
            {\buildcirclepm{\scriptscriptstyle}{0.08ex}{0.95}{0.03ex}{.45}}
    }
}
\newcommand{\omp}{
    \mathbin{
        \mathchoice
            {\buildcirclemp{\displaystyle     }{0.14ex}{0.95}{0.05ex}{.7}}
            {\buildcirclemp{\textstyle        }{0.14ex}{0.95}{0.05ex}{.7}}
            {\buildcirclemp{\scriptstyle      }{0.13ex}{0.955}{0.04ex}{.55}}
            {\buildcirclemp{\scriptscriptstyle}{0.08ex}{0.95}{0.03ex}{.45}}
    }
}
\newcommand\buildcirclepm[5]{%
    \begin{tikzpicture}[baseline=(X.base), inner sep=-#5, outer sep=-.65]
        \node[draw,circle,line width=#4] (X)  {\footnotesize\raisebox{#2}{\scalebox{#3}{$#1\pm$}}};
    \end{tikzpicture}%
}
\newcommand\buildcirclemp[5]{%
    \begin{tikzpicture}[baseline=(X.base), inner sep=-#5, outer sep=-.65]
        \node[draw,circle,line width=#4] (X)  {\footnotesize\raisebox{#2}{\scalebox{#3}{$#1\mp$}}};
    \end{tikzpicture}%
}

\DeclareDocumentCommand{\dilateerode}{}{\opm}
\DeclareDocumentCommand{\erodedilate}{}{\omp}


\usetikzlibrary{spy}
\tikzset{
    centerbase/.style={baseline={([yshift=-0.5ex]current bounding box.center)}},
}
\usetikzlibrary{calc}


\title{Morphologische Filter}

\author{Stephan Hilb}
\date{\today}
\institute{Universität Stuttgart}


\begin{document}


\begin{frame}
    \titlepage
\end{frame}


\section{Einführung}

\subsection{Beispiele und Motivation}

\begin{frame}
    \frametitle{Morphologische Filter}
    \begin{itemize}
        \item
            Mathematische Morphologie: Analyse räumlicher Strukturen eines Bildes
        \item
            Grundlegende morphologische Operatoren: Erosion, Dilatation
        \item
            Kompliziertere Operatoren, meist zusammengesetzt
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Beispiel: Dilatation}
    \begin{center}
        \pause
        \begin{onlyenv}<2-4>
            \begin{tikzpicture}[centerbase]
                \node[anchor=south west,inner sep=0] (im) at (0,0) {\includegraphics[width=4.2cm]{images/phantom80.png}};
            \end{tikzpicture}
        \end{onlyenv}%
        \begin{onlyenv}<5->
            \begin{tikzpicture}[centerbase,spy using outlines={circle,magnification=6,size=2.5cm,connect spies}]
                \node[anchor=south west,inner sep=0] (im) at (0,0) {\includegraphics[width=4.2cm]{images/phantom80.png}};
                \begin{scope}[x={($1/80*(im.south east)$)},y={($1/80*(im.north west)$)},xshift=0.11,yshift=-0.09]
                    \coordinate<-5> (x) at (20,59);
                    \coordinate<6> (x) at (20,60);
                    \coordinate<7> (x) at (20,61);
                    \coordinate<8> (x) at (20,62);
                    \coordinate<9> (x) at (19,62);
                    \coordinate<10> (x) at (18,62);
                    \coordinate<11> (x) at (17,62);
                    \coordinate<12> (x) at (16,62);
                    \coordinate (xsw) at ($(x) - (1,1)$);
                    \coordinate (xm) at ($(x) + (0.5,0.5)$);
                    \draw[line width=0.05pt,red] (xsw) rectangle +(3,3);
                    \draw[line width=0.05pt,red] (xsw) grid[step=1] +(3,3);
                    \draw[line width=0.05pt,green] (xsw) ++ (1,1) rectangle +(1,1);
                    \fill[red] (xsw) +(1.5,1.5) circle[radius=0.1];
                    \spy[yellow!80!black] on (xm) in node[above left,xshift=-0.5cm,yshift=0.5cm] at (im.south east);
                \end{scope}
            \end{tikzpicture}
        \end{onlyenv}%
        \pause
        $\dilate$
        \begin{tikzpicture}[centerbase,scale=0.3]
            \fill[black!30] (0,0) rectangle (3,3);
            \draw[very thin] (0,0) grid (3,3);
            \fill (1.5,1.5) circle[radius=0.1];
        \end{tikzpicture}
        $=$
        \pause
        \begin{onlyenv}<2-4>
            \begin{tikzpicture}[centerbase]
                \node[anchor=south west,inner sep=0] (im) at (0,0) {\includegraphics[width=4.2cm]{images/phantom80_dilate.png}};
            \end{tikzpicture}
        \end{onlyenv}%
        \begin{onlyenv}<5->
            \begin{tikzpicture}[centerbase,spy using outlines={circle,magnification=6,size=2.5cm,connect spies}]
                \node[anchor=south west,inner sep=0] (im) at (0,0) {\includegraphics[width=4.2cm]{images/phantom80_dilate.png}};
                \begin{scope}[x={($1/80*(im.south east)$)},y={($1/80*(im.north west)$)},xshift=0.11,yshift=-0.09]
                    \coordinate<-5> (x) at (20,59);
                    \coordinate<6> (x) at (20,60);
                    \coordinate<7> (x) at (20,61);
                    \coordinate<8> (x) at (20,62);
                    \coordinate<9> (x) at (19,62);
                    \coordinate<10> (x) at (18,62);
                    \coordinate<11> (x) at (17,62);
                    \coordinate<12> (x) at (16,62);
                    \coordinate (xsw) at (x);
                    \coordinate (xm) at ($(x) + (0.5,0.5)$);
                    \draw[ultra thin,green] (xsw) rectangle +(1,1);
                    %\draw[line width=0.05pt,red] (xsw) grid[step=1] +(3,3);
                    %\fill[red] (xsw) +(1.5,1.5) circle[radius=0.1];
                    \spy[yellow!80!black] on (xm) in node[above left,xshift=-0.5cm,yshift=0.5cm] at (im.south east);
                \end{scope}
            \end{tikzpicture}
        \end{onlyenv}
    \end{center}
\end{frame}

\begin{frame}
    \frametitle{Beispiel: Erosion}
    \begin{center}
        \pause
        \begin{onlyenv}<2-4>
            \begin{tikzpicture}[centerbase]
                \node[anchor=south west,inner sep=0] (im) at (0,0) {\includegraphics[width=4.2cm]{images/phantom80.png}};
            \end{tikzpicture}
        \end{onlyenv}%
        \begin{onlyenv}<5->
            \begin{tikzpicture}[centerbase,spy using outlines={circle,magnification=6,size=2.5cm,connect spies}]
                \node[anchor=south west,inner sep=0] (im) at (0,0) {\includegraphics[width=4.2cm]{images/phantom80.png}};
                \begin{scope}[x={($1/80*(im.south east)$)},y={($1/80*(im.north west)$)},xshift=0.11,yshift=-0.09]
                    \coordinate<-5> (x) at (20,59);
                    \coordinate<6> (x) at (20,60);
                    \coordinate<7> (x) at (20,61);
                    \coordinate<8> (x) at (20,62);
                    \coordinate<9> (x) at (19,62);
                    \coordinate<10> (x) at (18,62);
                    \coordinate<11> (x) at (17,62);
                    \coordinate<12> (x) at (16,62);
                    \coordinate (xsw) at ($(x) - (1,1)$);
                    \coordinate (xm) at ($(x) + (0.5,0.5)$);
                    \draw[line width=0.05pt,red] (xsw) rectangle +(3,3);
                    \draw[line width=0.05pt,red] (xsw) grid[step=1] +(3,3);
                    \draw[line width=0.05pt,green] (xsw) ++ (1,1) rectangle +(1,1);
                    \fill[red] (xsw) +(1.5,1.5) circle[radius=0.1];
                    \spy[yellow!80!black] on (xm) in node[above left,xshift=-0.5cm,yshift=0.5cm] at (im.south east);
                \end{scope}
            \end{tikzpicture}
        \end{onlyenv}%
        \pause
        $\erode$
        \begin{tikzpicture}[centerbase,scale=0.3]
            \fill[black!30] (0,0) rectangle (3,3);
            \draw[very thin] (0,0) grid (3,3);
            \fill (1.5,1.5) circle[radius=0.1];
        \end{tikzpicture}
        $=$
        \pause
        \begin{onlyenv}<2-4>
            \begin{tikzpicture}[centerbase]
                \node[anchor=south west,inner sep=0] (im) at (0,0) {\includegraphics[width=4.2cm]{images/phantom80_erode.png}};
            \end{tikzpicture}
        \end{onlyenv}%
        \begin{onlyenv}<5->
            \begin{tikzpicture}[centerbase,spy using outlines={circle,magnification=6,size=2.5cm,connect spies}]
                \node[anchor=south west,inner sep=0] (im) at (0,0) {\includegraphics[width=4.2cm]{images/phantom80_erode.png}};
                \begin{scope}[x={($1/80*(im.south east)$)},y={($1/80*(im.north west)$)},xshift=0.11,yshift=-0.09]
                    \coordinate<-5> (x) at (20,59);
                    \coordinate<6> (x) at (20,60);
                    \coordinate<7> (x) at (20,61);
                    \coordinate<8> (x) at (20,62);
                    \coordinate<9> (x) at (19,62);
                    \coordinate<10> (x) at (18,62);
                    \coordinate<11> (x) at (17,62);
                    \coordinate<12> (x) at (16,62);
                    \coordinate (xsw) at (x);
                    \coordinate (xm) at ($(x) + (0.5,0.5)$);
                    \draw[ultra thin,green] (xsw) rectangle +(1,1);
                    %\draw[line width=0.05pt,red] (xsw) grid[step=1] +(3,3);
                    %\fill[red] (xsw) +(1.5,1.5) circle[radius=0.1];
                    \spy[yellow!80!black] on (xm) in node[above left,xshift=-0.5cm,yshift=0.5cm] at (im.south east);
                \end{scope}
            \end{tikzpicture}
        \end{onlyenv}
    \end{center}
\end{frame}


\subsection{Definitionen und Notationen}

\begin{frame}
    \frametitle{Bilder}
    \begin{definition}
        Ein \emph{Bild} ist eine Abbildung $u: \Omega \to F$.
        Dabei sei
        \begin{enumerate}[1.]
            \item \pause
                die \emph{Trägermenge} $\Omega$ entweder $\R^d$ oder $\Z^d$ und
            \item \pause
                der \emph{Farbraum} $F$ bestehend aus Grauwerten, speziell: $F = [0,1]$.
        \end{enumerate}
    \end{definition}
    \pause
    Für $F = [0,1]$ interpretiert man $0$ als Schwarz und $1$ als Weiß.
\end{frame}

\begin{frame}
    \frametitle{Strukturelemente}
    \begin{definition}
        Ein \emph{Strukturelement} ist eine Teilmenge $B \subset \Omega$.
    \end{definition}
    \pause
    Wir visualisieren Strukturelemente als Bilder:
    \begin{center}
        \begin{tikzpicture}[scale=0.4,centerbase]
            \draw[fill=black!30] (0,0) rectangle (3,1);
            \draw (1,0) -- (1,1) (2,0) -- (2,1);
            \fill (1.5,0.5) circle[radius=0.1];
        \end{tikzpicture}
        \qquad
        \begin{tikzpicture}[scale=0.4,centerbase]
            \draw[fill=black!30] (1,0) rectangle (2,3);
            \draw[fill=black!30] (0,1) rectangle (3,2);
            \draw (1,1) -- (1,2) (2,1) -- (2,2);
            \fill (1.5,1.5) circle[radius=0.1];
        \end{tikzpicture}
        \qquad
        \begin{tikzpicture}[scale=0.4,centerbase]
            \draw[fill=black!30] (0,0) rectangle (3,3);
            \draw (0,0) grid (3,3);
            \fill (1.5,1.5) circle[radius=0.1];
        \end{tikzpicture}
        \qquad
        \begin{tikzpicture}[scale=0.4,centerbase]
            \draw[fill=black!30] (0,0) rectangle (1,1);
            \draw[fill=black!30] (1,0) rectangle (2,1);
            \draw[fill=black!30] (0,2) rectangle (1,3);
            \draw[fill=black!30] (2,2) rectangle (3,3);
            \fill (1.5,1.5) circle[radius=0.1];
        \end{tikzpicture}
    \end{center}
\end{frame}

\begin{frame}
    \frametitle{Elementare Operationen und Relationen auf Bildern}
    \begin{definition}
        Für ein Bild $u: \Omega \to F$ definiere
        \begin{itemize}
            \item \pause
                die \emph{Translation} $u^p(x) := u(x-p)$ um $p \in \Omega$ \pause und
            \item
                das \emph{Komplement} $(\complement u)(x) := 1 - u(x)$.
        \end{itemize}
        \pause
        Für eine Menge $U$ aus Bildern $\Omega \to F$ definiere
        \begin{itemize}
            \item \pause
                die \emph{Vereinigung} $(\bigvee_{u \in U} u)(x) := \sup \Set{u(x) & u \in U}$ \pause und
            \item
                den \emph{Schnitt} $(\bigwedge_{u \in U} u)(x) := \inf \Set{u(x) & u \in U}$.
        \end{itemize}
        \pause
        Für zwei Bilder $u, v: \Omega \to F$ schreiben wir $u \le v$, wenn $u(x) \le v(x)$ an jeder Stelle $x \in \Omega$ gilt.
    \end{definition}
\end{frame}

\begin{frame}
    \frametitle{Elementare Operationen auf Strukturelementen}
    \begin{definition}
        Für Strukturelemente $B, C \subset \Omega$ definiere
        \begin{itemize}
            \item \pause
                die \emph{Spiegelung} $-B := \Set{-b & b \in B}$\pause,
            \item
                die \emph{Translation} $B + p := \Set{b + p & b \in B}$ \pause und
            \item
                die \emph{Addition} $B + C := \Set{b + c & b \in B, c \in C}$.
        \end{itemize}
    \end{definition}
\end{frame}

\section{Erosion, Dilatation}

\subsection{Definition}

\begin{frame}
    \frametitle{Definition der Erosion}
    \begin{definition}
        Für ein Bild $u$ und ein Strukturelement $B$ sei die \emph{Erosion}
        \begin{math}
            u \erode B := \bigvee_{b \in B} u^{-b}.
        \end{math}
    \end{definition}
\end{frame}

\begin{frame}
    \frametitle{Definition der Dilatation}
    \begin{definition}
        Für ein Bild $u$ und ein Strukturelement $B$ sei die \emph{Dilatation}
        \begin{math}
            u \dilate B := \bigwedge_{b \in B} u^{-b}.
        \end{math}
    \end{definition}
\end{frame}

\subsection{Eigenschaften}

\begin{frame}
    \frametitle{Eigenschaften von Erosion und Dilatation}
    \begin{lemma}
        Erosion und Dilatation genügen den Eigenschaften
        \begin{itemize}
            \item
                \emph{Dualität}: $u \dilateerode B = \complement (\complement u \erodedilate B)$,
            \item
                \emph{Translationsinvarianz}: $u^p \dilateerode B = (u \dilateerode B)^p$ für $p \in \Omega$,
            \item
                \emph{Monotonie}: $u \le v \implies u \dilateerode B \le v \dilateerode B$,
            \item
                \emph{Distributivität}: $(u \veewedge v) \dilateerode B = (u \dilateerode B) \veewedge (v \dilateerode B)$,
            \item
                \emph{Komposition}: $(u \dilateerode B) \dilateerode C = u \dilateerode (B + C)$,
            \item
                \emph{(Anti-)Extensionalität}: es sind äquivalent:
                \begin{enumerate}[i)]
                    \item
                        $0 \in B$,
                    \item
                        $u \erode B \le u$ für alle $u$,
                    \item
                        $u \le u \dilate B$ für alle $u$.
                \end{enumerate}
        \end{itemize}
    \end{lemma}
\end{frame}


\section{Zusammengesetzte Operationen}

\subsection{Öffnen, Schließen}

\begin{frame}
    \frametitle{Definition der Öffnung}
    \begin{definition}
        Definiere die \emph{Öffnung} als
        \begin{math}
            u \open B := (u \erode B) \dilate (-B).
        \end{math}
    \end{definition}
\end{frame}

\begin{frame}
    \frametitle{Definition der Schließung}
    \begin{definition}
        Definiere die \emph{Schließung} als
        \begin{math}
            u \close B := (u \dilate B) \erode (-B).
        \end{math}
    \end{definition}
\end{frame}

\begin{frame}
    \frametitle{Vergleich von Öffnung und Schließung}
\end{frame}

\begin{frame}
    \frametitle{Eigenschaften von Öffnung und Schließung}
    \begin{lemma}
        Öffnung und Schließung erben von Erosion und Dilatation die Eigenschaften
        \begin{itemize}
            \item
                \emph{Dualität}: $u \openclose B = \complement (\complement u \closeopen B)$,
            \item
                \emph{Translationsinvarianz}: $u^p \openclose B = (u \openclose B)^p$,
            \item
                \emph{Monotonie}: $u \le v \implies u \openclose B \le u \openclose B$,
            \item
                \emph{Distributivität}: $(u \veewedge v) \openclose B = (u \openclose B) \veewedge (v \openclose B)$.
        \end{itemize}
    \end{lemma}
\end{frame}

\begin{frame}
    \frametitle{Eigenschaften von Öffnung und Schließung}
    \begin{lemma}
        Öffnung und Schließung genügen den Eigenschaften
        \begin{itemize}
            \item
                \emph{Translationsinvarianz bezüglich des Strukturelements}: $u \openclose B = u \openclose (B + p)$,
            \item
                \emph{Idempotenz}: $(u \openclose B) \openclose B = u \openclose B$,
            \item
                \emph{(Anti-)Extensionalität}: $u \open B \le u \le u \close B$.
        \end{itemize}
    \end{lemma}
\end{frame}

\subsection{Top-hat Filter}

\begin{frame}
    \frametitle{Definition der Top-hat Filter}
    \begin{definition}
        Definiere den \emph{White-top-hat Operator}
        \begin{math}
            u \wtophat B = u - u \open B
        \end{math}
        und den \emph{Black-top-hat Operator}
        \begin{math}
            u \btophat B = u \close B - u.
        \end{math}
    \end{definition}
\end{frame}

\subsection{Hit-or-Miss Filter}

\begin{frame}
    \frametitle{Definition des Hit-or-Miss Filters}
    \begin{definition}
        Für ein Bild $u$ und zwei Strukturelemente $B, C \subset \Omega$ definiere den \emph{Hit-or-Miss Filter}
        \begin{math}
            u \hitormiss (B,C) := (u \erode B) \vee (\complement u \erode C).
        \end{math}
    \end{definition}
\end{frame}

\subsection{Morphologische Gradienten}

\begin{frame}
\end{frame}

\section{Anwendungen und Beispiele}

\begin{frame}
    
\end{frame}



\end{document}
